% -*- mode: latex-mode; TeX-engine: xetex; LaTeX-command-style: (("" "SOURCE_DATE_EPOCH=0 %(PDF)%(latex) --shell-escape %S%(PDFout)")); TeX-master: "../dissertation.tex"; -*-

\chapter{Computer Control Hardware Specification}
\label{appendex:computer-control}

In this appendex we list the specification of the important hardware
used in our computer control system.
See section~\ref{ch:computer-control:backend} for the integration
of these hardware into the system.

\section{FPGA}
\label{appendex:computer-control:fpga}

We use the \href{https://www.xilinx.com/products/boards-and-kits/ek-z7-zc702-g.html}{ZC702 evaluation board}~(part number EK-Z7-ZC702-G).
The on board CPU has a maximum clock speed of $666.667~\mathrm{MHz}$
and supports the VFPv3 and NEON extension for floating point and SIMD instructions.
The board also includes $1~\mathrm{GiB}$ of DDR3 RAM connected to the CPU.
The FPGA is configured to run at $100~\mathrm{MHz}$ which determines
the highest timing resolution of $10~\mathrm{ns}$ in our experiment.

We connect the FPGA to the peripherals using two FMC LPC connectors
each containing 68 pins used for single-ended signals.
Each FMC connector is used to control 11 DDS's,
which will be described in section~\ref{appendex:computer-control:dds},
and one of the connector is also used to output 32 logical control signals
and the clock to synchronize with other devices.

The DDS's on each FMC connector are controlled using a shared parallel bus
with 7-bit address, 16-bit data and 6 control signals.
A chip select pin for each DDS is used to enable the relevant one for update.
The setup allows, in general case, one DDS on each FMC connector to be programmed
simultaneously while at the same time updating the logical outputs.
This concurrently update capability, however, is not currently used in the experiment
and only one update at a time is allowed.

\section{DDS}
\label{appendex:computer-control:dds}

The DDS we use is \href{https://www.analog.com/en/products/ad9914.html}{AD9914}
from Analog Devices.
The chip runs on an external clock of $3.5~\mathrm{GHz}$,
which sets the sampling rate of $3.5~\mathrm{GS/s}$,
and can directly output frequency up to $1.4~\mathrm{GHz}$.
We configure the chip to use a single profile and output a fixed frequency and amplitude
at any given time.
Using the 16-bit data bus,
the amplitude has a resolution of 12-bit taking one 16-bit write to update or $160~\mathrm{ns}$,
whereas the frequency has a resolution of 31-bit
taking two 16-bit write to update or $240~\mathrm{ns}$\footnote{
  Currently we conservatively wait for a total of $500~\mathrm{ns}$
  before issuing the next command.
  However, it is likely that this wait time can be shortened.
}.

We use a \href{https://www.minicircuits.com/WebStore/dashboard.html?model=ERA-4XSM\%2B}{ERA-4XSM+}
gain block to amplify the signal from the DDS which gives a maximum power of $12~\mathrm{dBm}$
at low frequencies~($\leqslant100~\mathrm{MHz}$) and gradually decreases to $8~\mathrm{dBm}$
around $1~\mathrm{GHz}$.
We measure the noise on the output after the amplifier.
We saw a low second harmonic power of $-40\sim-50~\mathrm{dBc}$
over a wide frequency range of $80\sim900~\mathrm{MHz}$.
We also observed distortion when the output frequency is closed to
a fraction of the clock frequency but the effect is also relatively small
($\approx-40~\mathrm{dBc}$).
Finally, we measure the crosstalk between different channels.
With a single channel outputing at maximum amplitude,
we observed a $\approx-40\sim-50~\mathrm{dBc}$ crosstalk between the channels.
This is comparable to other noice on the output, however,
the effect can be greater on a DDS outputting lower power.
For this reason, we ensure the DDS are outputting maximum power most of the time
so that they are less susceptible to noice from other channels.
For important noise sensitive channels,
we also use additional methods including filtering, RF switches,
light shutters~(when the channel is driving an AOM)
and offsetting the output frequencies from each other to minimize any crosstalk effects.

\section{NI DAQ Card}
\label{appendex:computer-control:nidaq}

\todo{
  Part number
  Voltage range, resolution
  refresh speed
  external trigger and clock
  Ground isolation
}

\section{USRP}
\label{appendex:computer-control:usrp}

\todo{
  Part number
  Daughter board, noise with higher frequency daughter board
  sampling rate/bandwidth
  output power
}
